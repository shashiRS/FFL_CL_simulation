# VSP_SEF_Brake
## Brake surrogate models

## Getting Access & Permissions
Every user in the ADAS GitHub Team has read access. To get write access, please write to our mail group: au_fr_mg_cls_sil@continental.com or ask one of the following:
Laxmi Vijayaraghavan laxmi.vijayaraghavan@continental.com or
Thomas Meißner thomas.meissner@continental.com
to add you to the GitHub team that has write access.

## Responsible
Thomas Meißner thomas.meissner@continental.com

## Description
* Refer following link for BRICKS setup and CM version requirements: [Environment Pre-Requisites](https://github-am.geo.conti.de/ADAS/CLS-SIL#environment-setup-prerequisites)
* For Brake Modelling details refer following link: [Brake Model Documentation Download](https://confluence-adas.zone2.agileci.conti.de/display/VSP/Brake+Models) 


To build the OCTAGONBrake model and CarMaker binray execute below build scripts,

* Windows and Release build type

```console
Brake_bricks_build_release.bat
```
* Windows and Debug build type

```console
Brake_bricks_build_debug.bat
```

* To build the project for Linux:

```console
linux_cm_release.sh
```

# Motion Control Brake Model
The brake model from Motion Control is a standalone Simulink model which can be used as reference model in two CarMaker wrapper models depending on use. These CarMaker wrapper models are of generic model class. For building the model you need a Matlab R2019b installation.

*MoCo_Brake_CMcoder.slx* found in /tests/carmaker/src/MoCo_Brake/ is intended to be used as a CarMaker plugin. Build this model directly in Simulink to create a carmaker.win64.exe which can be used in CarMaker standalone.

*MoCo_Brake_Autocode.slx* found in /src/package/MoCo_Brake/ is intended to create autocode source files which can then be later build using cmake.
Building it that way results also in a carmaker.win64.exe which can be used in CarMaker standalone. This method is required to create BRICKS compatible source files for using this model in BRICKS. 
The process for building the model using cmake is described below:

## Model Build using cmake:
1. Build the MoCo_Brake_Autocode.slx model in Simulink. Following a error-free build, it will generate the autocode source files.
2. Set the option *MoCo_Brake* in the CMakeList.txt file under *tests/carmaker* folder (line 18) to *ON* status OR execute the cmake build with additional option as in 3.
3. Build the main CMakeLists.txt file in a created /build-folder at top level of the Repo using the command

	For Windows
    cmake -A x64 -DMoCo_Brake=ON ..
	
	For Linux:
	cmake -DMoCo_Brake=ON && make -j8
    
   The  option "-DMoCo_Brake=ON" is not required if 2. was not done.
4. Build the Visual Studio project to generate the CarMaker.win64.exe (if not already generated by cmake build)

## Model Usage
 1. Select the CarMaker executable from under /tests/carmaker/src/ for CMcoder option or under /tests/carmaker/bin/Debug/ folder for cmake option and start it from CarMaker GUI
 2. In the Additional Parameter section of the Misc Tab of the Vehicle Data Set, include the MoCo_BrakeModel as an external file of the generic model class (the file can be found under *Data/Misc/BrakeParameters/MoCo_Brake/VW_Passat*) or copy the below line
 
	*GenericPlugin.MoCo_BrakeModel.FName = BrakeParameters/MoCo_Brake/VW_Passat/MoCo_Brake_Model*
 
 3. By detault the Autocode version is used. For the CMcoder option, the following entries have to be modified:

	GenericPlugin.MoCo_Brake_**<Autocode/CMcoder>**.FName = BrakeParameters/MoCo_Brake/VW_Passat/MoCo_Brake_Model - in vehicle InfoFile
	
	FileIdent = CarMaker-Generic-MoCo_Brake_**<Autocode/CMcoder>** 1 - MoCo Brake Parameter InfoFile
	
	GenericPlugin.MoCo_Brake_**<Autocode/CMcoder>**.AbsPlace = BC - MoCo Brake Parameter InfoFile
	
	GenericPlugin.MoCo_Brake_**<Autocode/CMcoder>**.Reload = Always - MoCo Brake Parameter InfoFile
	
	
 4. The input to the model is provided as a negative target torque value to the signal *MoCoBrake.Target_Trq*
 5. An example TestRun *MoCo_Braking* is provided with all necessary pre-configuration. The target torque to the brake model is provided here via Minimaneuver command
